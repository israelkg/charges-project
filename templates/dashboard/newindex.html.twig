{% extends 'base.html.twig' %}

{% block title %}Dashboard{% endblock %}

{% block body %}

  <div class="mb-10">
    <h1 class="text-4xl font-bold text-gray-100 mb-2">Bem-vindo, {{ app.user.name }} 👋</h1>
    <p class="text-lg text-gray-300">Aqui está uma visão geral da sua atividade financeira.</p>
  </div>

  <!-- Destaques -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
    <div class="bg-gray-800 rounded-2xl p-6 shadow-md flex items-center gap-4">
      <div class="bg-blue-600 text-white p-4 rounded-full">
        📩
      </div>
      <div>
        <h3 class="text-xl font-bold text-white">1.245</h3>
        <p class="text-gray-300 text-sm">Cobranças Emitidas</p>
      </div>
    </div>
    <div class="bg-gray-800 rounded-2xl p-6 shadow-md flex items-center gap-4">
      <div class="bg-red-600 text-white p-4 rounded-full">
        📂
      </div>
      <div>
        <h3 class="text-xl font-bold text-white">34</h3>
        <p class="text-gray-300 text-sm">Cobranças Atrasadas</p>
      </div>
    </div>
    <div class="bg-gray-800 rounded-2xl p-6 shadow-md flex items-center gap-4">
      <div class="bg-green-600 text-white p-4 rounded-full">
        👤
      </div>
      <div>
        <h3 class="text-xl font-bold text-white">5.245</h3>
        <p class="text-gray-300 text-sm">Total de Clientes</p>
      </div>
    </div>
  </div>

  <!-- Informações de perfil e análise -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-12">
    <div class="bg-gray-800 p-6 rounded-2xl shadow-md text-gray-200">
      <h2 class="text-xl font-bold mb-4">Seu Perfil</h2>
      <ul class="space-y-2 text-sm">
        <li><strong>Nome:</strong> {{ app.user.name }}</li>
        <li><strong>Email:</strong> {{ app.user.email }}</li>
        <li>
          <a href="{{ path('app_dashboard_export_pdf') }}"
             class="inline-block mt-4 px-4 py-2 bg-red-600 text-white font-semibold rounded-md shadow hover:bg-red-500 transition">
            🖨️ Exportar PDF
          </a>
        </li>
      </ul>
    </div>

    <div class="bg-gray-800 p-6 rounded-2xl shadow-md text-gray-200">
      <h2 class="text-xl font-bold mb-4">Análise Inteligente</h2>
      <ul class="space-y-3 text-sm leading-relaxed">
        <li>💸 <strong>Faixa de Valores:</strong> Maioria paga entre <span class="text-white font-semibold">R$101-300</span>.</li>
        <li>📈 <strong>Receita:</strong> Faturamento <span class="text-green-400 font-semibold">em alta</span> nos últimos meses.</li>
        <li>⏱️ <strong>Prazo Médio:</strong> Pagamento em até <span class="text-yellow-400 font-semibold">3 dias após vencimento</span>.</li>
        <li>📦 <strong>Serviço Destaque:</strong> <span class="font-semibold">[Nome do serviço]</span> tem maior retorno.</li>
      </ul>
    </div>
  </div>

  <!-- Cobranças recentes -->
  <div class="mb-16">
    <h2 class="text-2xl font-semibold text-gray-100 mb-4">Últimas Cobranças</h2>

    {% if cobrancas is not empty %}
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        {% for cobranca in cobrancas|slice(0, 4) %}
          <div class="bg-gray-800 text-gray-100 p-6 rounded-xl shadow-md hover:shadow-lg transition duration-300">
            <h3 class="text-lg font-semibold mb-2">{{ cobranca.descriptioncharge }}</h3>
            <p class="text-sm mb-1"><strong>Valor:</strong> R$ {{ cobranca.amount }}</p>
            <p class="text-sm mb-2">
              <strong>Status:</strong>
              {% if cobranca.status == 'pendente' %}
                <span class="text-yellow-400 font-semibold">Pendente</span>
              {% elseif cobranca.status == 'paga' %}
                <span class="text-green-400 font-semibold">Paga</span>
              {% else %}
                <span class="text-gray-300">{{ cobranca.status }}</span>
              {% endif %}
            </p>
            <a href="{{ path('app_charges_show', { id: cobranca.id }) }}"
               class="inline-block mt-3 text-sm font-medium text-blue-400 hover:underline">
              Ver Detalhes →
            </a>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-gray-300">Você ainda não possui cobranças cadastradas.</p>
    {% endif %}
  </div>

  <!-- Gráficos -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-20">
    {% set cards = [
      {'id': 'chargeStatus', 'title': 'Status das Cobranças'},
      {'id': 'chargeMonth', 'title': 'Cobranças por Mês'},
      {'id': 'recipeAcumulate', 'title': 'Receita Acumulada'},
      {'id': 'valueRange', 'title': 'Faixa de Valores'}
    ] %}

    {% for card in cards %}
      <div class="bg-gray-800 rounded-2xl p-6 shadow-md hover:shadow-lg transition-colors duration-300">
        <h3 class="text-lg font-semibold text-white mb-4">{{ card.title }}</h3>
        <div class="w-full h-80 flex items-center justify-center">
          <canvas class="graficos" id="{{ card.id }}"></canvas>
        </div>
      </div>
    {% endfor %}
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="{{ asset('js/charts/chargeStatus.js') }}"></script>
  <script src="{{ asset('js/charts/chargeMonth.js') }}"></script>
  <script src="{{ asset('js/charts/recipeAcumulate.js') }}"></script>
  <script src="{{ asset('js/charts/valueRange.js') }}"></script>

{% endblock %}
